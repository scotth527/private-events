
<div class="col-6 mx-auto">
    <h1><%= @event.title %></h1>

    <h4>Description: </h4>
    <p><%= @event.description %></p>

    <h4>Creator: </h4>
    <strong><%= link_to @event.creator.username , @event.creator %></strong>

    <h4>Location: </h4>
    <div><%= @event.location %></div>

    <% if @event.date.present? %>
    <h4>Date: </h4>
    <div><%= @event.date.strftime("%B %d %Y") %></div>
    <% end %>

    <% if (@event.creator.username == current_user.username && @users.select {
        | user | !@event.attendees.any? { |attendee| attendee.id == user.id  }
    }.length() > 0 ) %>

        <%= form_with url: "/rsvps", method: :post do |form| %>
          <%= form.hidden_field :event_id, :value => @event.id  %>
          <%= form.hidden_field :status, :value => "Pending"  %>


          <%= form.label :user_id, "Invite User:" %>

          <%= form.select :user_id, options_for_select(@users.select {
              | user | !@event.attendees.any? { |attendee| attendee.id == user.id  }
          }.collect{ |u| [u.username, u.id] }), class:"form-control" %>
          <%= form.submit "Invite" %>
        <% end %>

    <% end %>

    <%# Check if user is already been invited %>
    <% if @event.attendees.any? {|attendee| attendee.id == current_user.id } %>
        <div>
        <%= button_to "Attend",
            rsvp_path(rsvp_id: @event.rsvps.select { |attendee|
                p "Attendee"
                p attendee
                attendee.user_id == current_user.id
            }[0].id,
            event_id: @event.id, user_id: current_user.id, status: "Attending"),
            method: :patch,
            class:"btn btn-success " %>

        <%= button_to "Decline",
            rsvp_path(rsvp_id: @event.rsvps.select { |attendee|
                p "Attendee"
                p attendee
                attendee.user_id == current_user.id
            }[0].id,
            event_id: @event.id, user_id: current_user.id, status: "Declined"),
            method: :patch,
            class:"btn btn-danger " %>
        </div>
    <% end %>

    <div>
        <p>Number of attendees:
            <span>
                <%= @event.rsvps.select {|attendee| attendee.status == "Attending" }.length()  %>
            </span>
        </p>
        <p>
            <span>Attending</span>
            <ul>

                    <% @event.rsvps.each do |attendee| %>
                        <% if attendee.status == "Attending" %>
                            <li>
                                <%= attendee.attendee.username %>
                            </li>
                        <% end %>
                    <% end %>

            </ul>

            <span>Pending</span>
            <ul>

                    <% @event.rsvps.each do |attendee| %>
                        <% if attendee.status == "Pending" %>
                            <li>
                                <%= attendee.attendee.username %>
                            </li>
                        <% end %>
                    <% end %>

            </ul>

            <span>Declined</span>
            <ul>

                    <% @event.rsvps.each do |attendee| %>
                        <% if (attendee.status != "Pending" && attendee.status != "Attending"  ) %>
                            <li>
                                <%= attendee.attendee.username %>
                            </li>
                        <% end %>
                    <% end %>

            </ul>
        </p>
    </div>



</div>
